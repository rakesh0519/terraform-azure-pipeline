trigger:
  - main  # Change this if your default branch is different

pool:
  vmImage: 'ubuntu-latest'

steps:
  - task: TerraformInstaller@0
    displayName: 'Install Terraform'
    inputs:
      terraformVersion: 'latest'

  - checkout: self  # Fetch code from GitHub

  - task: AzureCLI@2
    displayName: 'Azure Login'
    inputs:
      azureSubscription: 'AzureServiceConnection'
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: |
        az login --identity
        az account set --subscription 'a9abbc1e-f3f3-4acd-94f0-81d6b4d5289a'

  - script: |
      terraform init
      terraform validate
      terraform plan -out=tfplan
    workingDirectory: Terraform  # Ensure this matches your folder structure
    displayName: 'Terraform Init & Plan'

  - script: |
      terraform apply -auto-approve tfplan
    workingDirectory: Terraform
    displayName: 'Terraform Apply'
